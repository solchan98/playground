# Chapter 1. 사용자 수에 따른 규모 확장성

### 어떤 경우에 비-관계형 데이터베이스가 바람직한 선택인가?
1. 아주 낮은 응답 지연시간(latency)이 요구되는 서비스
2. 다루는 데이터가 비정형이라 관계형 데이터가 아닌 경우
3. 데이터를 직렬화 혹은 역직렬화 할 수 있기만 하는 경우
4. 아주 많은 양의 데이터를 저장할 필요가 있는 경우

### 무조건 스케일 아웃 & 수평적 규모 확장이 좋은가?
1. 서버로 유입되는 트래픽의 양이 적을 경우, 단순하게 스케일 업 & 수직적 규모 확장이 좋은 대안이 될 수 있다.

### 스케일 업 & 수직적 규모 확장의 경우 어떤 한계를 가지는가?
1. 한 대의 서버에 자원을 무한대로 증설할 수 없다.
2. 서버에 장애가 발생하면 서비스가 완전히 중당된다.

### 알고있는 데이터베이스 다중화의 동작 방식이 있는가?
1. 주(master) - 부(slave) 구성
2. slave가 죽은 경우
3. master가 죽은 경우
4. 안정성
    - 데이터 보존
5. 가용성
    - 서비스 가능

### 캐시 사용 시 유의할 점
1. 데이터 갱신 주기 고려
   1. 주기가 짧은지
2. 데이터 선택
   1. 휘발성 메모리에 적합한지  
3. 데이터 만료 정책
4. 일관성
   1. 저장소의 원본을 갱신하는 연산과 캐시를 갱신하는 연산이 단일 트랜잭션으로 처리되는지 등
5. 장애 대처
    1. 단일로 구성하는 경우 단일 장애 지점, SPOF(single point of failure) 될 수 있음
6. 메모리의 크기
7. 캐시 교체 정책
    1. LRU, LFU, FIFO

### CDN(Content Delivery Network) 동작 방식
1. CDN에서 1차 탐색
2. 없는 경우 원본 경로 탐색
3. CDN 캐싱
4. 응답

### CDN 사용 시 고려해야 할 사항
1. 비용
2. 만료 시간
3. 장애 대처
4. 컨텐츠 무효화
   - ex) 이미지가 업데이트 된 경우
   - Object Versioning 등 이용

### 다음의 조건을 만족하는 간단한 무상태(stateless) 웹 아키텍처 구성
1. 다중 서버
2. 다중 데이터베이스
3. CDN 적용
4. 캐시 적용
5. 클라이언트의 서버 직접 접근 차단
6. 트래픽 분산 처리

### 주(msater)-부(slave) 데이터베이스 간 동기화 방식

### 메시지 큐의 컨셉에 대해 설명

### 어떤 경우에 메시키 큐가 바람직한 선택인가?
- 비동기 처리

### 데이터베이스의 스케일 아웃 & 수평적 규모 확장에 대해 설명
- 샤딩

### 샤딩이 풀어야 할 문제
1. resharding 문제 : 특정 키의 샤드가 비교적 빠르게 공간 소모된 경우
   - consistent hashing 방식으로 해결 가능
2. celebrity(or hotspot) 문제 : 특정 샤드 query 집중 문제
3. join and de-normalization 문제 : 여러 샤드에 걸친 join 문제
   - 비정규화를 하여 하나의 테이블에서 query가 수행되도록 해결 가능

## 마무리
위 질문 정리들은 기본적인 무상태 웹 계층 아키텍처를 구성하기 위해 알아야 할 기본적인 내용이다.  
시스템 규모를 확장하는 것은 지속적이고 반복적인 과정이며, 수백만 이상의 사용자를 지원하려면 또 다른 전략을 도입해야 한다.  

다만, 시스템 규모 확장을 위해 기본적으로 알야아 할 기법들이다.
1. 웹 계층은 무상태 계층으로
2. 모든 계층에 다중화 도입
3. 가능한 많은 데이터를 캐시
4. 여러 데이터 센터를 지원
5. 정적 콘테츠는 CDN을 통해 서비스
6. 데이터 계층은 샤딩을 통해 규모를 확장
7. 각 계층은 독립적 서비스로 분할
8. 시스템을 지속적으로 모니터링하고, 자동화 도구 적극 활용
